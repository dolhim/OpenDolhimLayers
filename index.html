<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Layer Groups</title>

    <link rel="stylesheet" type="text/css" href="drlee_v3-demo.css">
    
    <link rel="stylesheet" href="css/ol.css" type="text/css">
    <script src="drlee_v3-demo.js"></script>
    <script src="build/ol.js"></script>
    <script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>

  </head>
  <body>
    <div id="leftsidenav" class="sidenav">
      <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <a href="#">About</a>
        <a href="#">Service</a>
        <a href="#">Clients</a>
        <a href="#">부가기능</a>
        <a href="#">설정</a>
    </div>

    <!-- 사이드 내비 -->
    <span id=leftmenubtn style="color:#ffffff; font-size:30px; cursor:pointer" onclick="openNav()">&#9776;</span>

    <div id="map" class="map"></div>

    <!-- 좌표 입력 후 엔터를 치면 이동 -->
    <div id="pantool">
      <h4>이동</h4> <h6>ex) 127 37</h6> <br />
      <input type="text" id=coordedit name="posXY">
    </div>

    <div id="layertree">
      <h4>레이어 설정</h4> <h6>Click a Layer name</h6>
        <table name="table" id="layertable">
          <th>레이어 명</th>
          <tr>
            <td><span>OSM layer</span>
              <fieldset id="layer0">
                <label class="checkbox" for="visible0">
                  <input id="visible0" class="visible" type="checkbox"/>visibility
                </label>
                <label>opacity</label>
                <input class="opacity" type="range" min="0" max="1" step="0.01"/>
              </fieldset>
            </td>
          </tr>
          <tr>
            <td><span>Layer Group</span>
            <fieldset id="layer1">
              <label class="checkbox" for="visible1">
                <input id="visible1" class="visible" type="checkbox"/>visibility
              </label>
              <label>opacity</label>
              <input class="opacity" type="range" min="0" max="1" step="0.01"/>
            </fieldset>
            <table name="table" id="layergrouptable">
            </table>
          </td>
        </table>
    </div>

    <!-- 하단 정보 출력-->
    <div id="footer">
      <span id="coordinate" style="" ></span>
    </div>

    <script type="text/javascript">

      var osmLayer = new ol.layer.Tile({
        source: new ol.source.OSM(),
        name: 'OSM layer'
      });

      var worldBorderLayer = new ol.layer.Tile({
        source: new ol.source.TileJSON({
          url: 'http://api.tiles.mapbox.com/v3/' +
               'mapbox.world-borders-light.json',
          crossOrigin: 'anonymous'
        }),
        name: 'World borders layer'
      });

      var layers = [ osmLayer , 
          new ol.layer.Group({
            layers: [
              worldBorderLayer
            ]
          })
      ];

      var map = new ol.Map({
        layers: layers,
        controls: ol.control.defaults().extend([
            new ol.control.FullScreen()
          ]),
        target: 'map',
        view: new ol.View({
          center: ol.proj.fromLonLat([127.40570, 37.81566]),
          zoom: 7
        }),
        // the renderer property can be set to 'canvas', 'dom' or 'webgl'
        renderer: 'canvas'
      });

       map.on('click', function(event) {
        var coord = event.coordinate;
        var degrees = ol.proj.transform(coord, 'EPSG:3857', 'EPSG:4326');
        // format a human readable version
        var hdms = ol.coordinate.toStringHDMS(degrees);
        var element = document.getElementById("coordinate");
        element.innerHTML = hdms;
      });

      map.getLayers().forEach(function(layer, i) {
        if (layer instanceof ol.layer.Group)  
          layer.getLayers().forEach((sublayer, j) => test(sublayer, j));
      });

      function test(sublayer, j) {
        var group = document.getElementById("layergrouptable");
        var strHTML =   
          '<tr><td><span>' + sublayer.get('name') + '</span>'  
          + '<fieldset id="layer0' + j + '">'  
          + '<label class="checkbox" for="visible0' + j +'">'  
          + '<input id="visible0' + j + '" class="visible" type="checkbox"/> visibility'
          + '</label><label> opacity </label>'
          + '<input class="opacity" type="range" min="0" max="1" step="0.01"/>'
          + '</fieldset></td></tr><tr>';
        group.innerHTML += strHTML;
      }

      map.getLayers().forEach(function(layer, i) {

        bindInputs('#layer' + i, layer);

        if (layer instanceof ol.layer.Group) {
          layer.getLayers().forEach(function(sublayer, j) {
            bindInputs('#layer0' + j, sublayer);
          });
        }
      });


      $('#layertable td > span').click(function() {
        $(this).siblings('fieldset').toggle();
      }).siblings('fieldset').hide();  

      $('#layertree li > span').click(function() {
        $(this).siblings('fieldset').toggle();
      }).siblings('fieldset').hide();      

      /* 좌표 입력 엔터 이벤트 추가 */
      $("#coordedit").keyup(function(event){
        if(event.keyCode == 13){
          var str = $("#coordedit").val().split(" ").map(Number);
          var loc = ol.proj.transform(str, 'EPSG:4326', 'EPSG:3857');
          doPan(loc);
        }
      });

    </script>
  </body>
</html>